var bt=Object.defineProperty;var Tt=(s,t,a)=>t in s?bt(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a;var p=(s,t,a)=>(Tt(s,typeof t!="symbol"?t+"":t,a),a);import{s as rt,f as m,a as T,l as lt,g as v,B as O,c as g,h as V,m as ut,d as h,j as R,G as gt,i as k,D as c,H as et,I as it,C as $,n as yt,J as ct,K as It,E as Pt,o as kt,F as wt,A as ht,L as Et}from"../chunks/scheduler.d1ddc063.js";import{S as dt,i as ft,b as mt,d as vt,m as _t,a as pt,t as xt,e as Ct}from"../chunks/index.08fa6e96.js";import{e as St}from"../chunks/each.ddcc6c50.js";import{P as Nt}from"../chunks/P5.f9f50a47.js";class $t{constructor(t=120,a,o){p(this,"audioContext");p(this,"notesInQueue",[]);p(this,"currentBeatInBar");p(this,"beatsPerBar");p(this,"tempo");p(this,"lookahead");p(this,"scheduleAheadTime");p(this,"nextNoteTime");p(this,"isRunning");p(this,"intervalID");p(this,"onBeatStart");p(this,"onBeatEnd");this.audioContext=null,this.notesInQueue=[],this.currentBeatInBar=0,this.beatsPerBar=4,this.tempo=t,this.lookahead=25,this.scheduleAheadTime=.1,this.nextNoteTime=0,this.isRunning=!1,this.intervalID=null,this.onBeatStart=a,this.onBeatEnd=o}nextNote(){var t=60/this.tempo;this.nextNoteTime+=t,this.currentBeatInBar++,this.currentBeatInBar==this.beatsPerBar&&(this.currentBeatInBar=0)}scheduleNote(t,a){if(!this.audioContext)return;this.notesInQueue.push({note:t,time:a});const o=this.audioContext.createOscillator(),i=this.audioContext.createGain();o.frequency.value=t%this.beatsPerBar==0?1e3:400,i.gain.value=1,i.gain.exponentialRampToValueAtTime(1,a+.001),i.gain.exponentialRampToValueAtTime(.001,a+.02),o.connect(i),i.connect(this.audioContext.destination);const l=this.audioContext.createConstantSource();l.onended=()=>{this.onBeatStart(t),o.start(),o.stop(a+.03),o.onended=()=>{this.onBeatEnd()}},l.start(a),l.stop(this.audioContext.currentTime+1e-4)}scheduler(){if(this.audioContext)for(;this.nextNoteTime<this.audioContext.currentTime+this.scheduleAheadTime;)this.scheduleNote(this.currentBeatInBar,this.nextNoteTime),this.nextNote()}start(){if(this.isRunning)return;const t=window.AudioContext||window.webkitAudioContext;if(!t)throw new Error("no audio context available");this.audioContext||(this.audioContext=new t);const a=this.audioContext,o=function(i){if(a){const l=a.createBuffer(1,1,22050),d=a.createBufferSource();d.buffer=l,d.connect(a.destination),d.start?d.start(0):d.play?d.play(0):d.noteOn&&d.noteOn(0)}document.removeEventListener("touchstart",o),document.removeEventListener("touchend",o)};document.addEventListener("touchstart",o),document.addEventListener("touchend",o),this.isRunning=!0,this.currentBeatInBar=0,this.nextNoteTime=this.audioContext.currentTime+.05,this.intervalID=setInterval(()=>this.scheduler(),this.lookahead)}stop(){this.isRunning=!1,this.intervalID&&clearInterval(this.intervalID)}startStop(){this.isRunning?this.stop():this.start()}}function At(s,t,a){const o=s.slice();return o[18]=t[a],o}function Dt(s){let t,a,o;return{c(){t=m("option"),a=lt(s[18]),o=T(),this.h()},l(i){t=v(i,"OPTION",{});var l=V(t);a=ut(l,s[18]),o=g(l),l.forEach(h),this.h()},h(){t.__value=s[18],et(t,t.__value)},m(i,l){k(i,t,l),c(t,a),c(t,o)},p:ht,d(i){i&&h(t)}}}function Lt(s){let t,a="Metronome",o,i,l,d=s[0].isRunning?"Pause":"Play",u,M,r,x,z="-5",K,_,W="-1",j,w,G="Tempo:",Q,C,q,e,y="+1",I,P,b="+5",H,S,A,nt="Beats in bar",Y,E,J,N,D,F,Z,ot,Bt=St([1,2,3,4,5,6,7,8,9,10]),U=[];for(let n=0;n<10;n+=1)U[n]=Dt(At(s,Bt,n));return D=new Nt({props:{sketch:s[2]}}),{c(){t=m("h3"),t.textContent=a,o=T(),i=m("div"),l=m("button"),u=lt(d),M=T(),r=m("div"),x=m("button"),x.textContent=z,K=T(),_=m("button"),_.textContent=W,j=T(),w=m("label"),w.textContent=G,Q=T(),C=m("input"),q=T(),e=m("button"),e.textContent=y,I=T(),P=m("button"),P.textContent=b,H=T(),S=m("div"),A=m("label"),A.textContent=nt,Y=T(),E=m("select");for(let n=0;n<10;n+=1)U[n].c();J=T(),N=m("div"),mt(D.$$.fragment),this.h()},l(n){t=v(n,"H3",{"data-svelte-h":!0}),O(t)!=="svelte-1ufzmuu"&&(t.textContent=a),o=g(n),i=v(n,"DIV",{});var f=V(i);l=v(f,"BUTTON",{});var L=V(l);u=ut(L,d),L.forEach(h),f.forEach(h),M=g(n),r=v(n,"DIV",{});var B=V(r);x=v(B,"BUTTON",{"data-svelte-h":!0}),O(x)!=="svelte-u06bp1"&&(x.textContent=z),K=g(B),_=v(B,"BUTTON",{"data-svelte-h":!0}),O(_)!=="svelte-xp648t"&&(_.textContent=W),j=g(B),w=v(B,"LABEL",{for:!0,"data-svelte-h":!0}),O(w)!=="svelte-1jbxdvi"&&(w.textContent=G),Q=g(B),C=v(B,"INPUT",{type:!0,min:!0,max:!0}),q=g(B),e=v(B,"BUTTON",{"data-svelte-h":!0}),O(e)!=="svelte-uulzng"&&(e.textContent=y),I=g(B),P=v(B,"BUTTON",{"data-svelte-h":!0}),O(P)!=="svelte-sukv70"&&(P.textContent=b),B.forEach(h),H=g(n),S=v(n,"DIV",{});var X=V(S);A=v(X,"LABEL",{for:!0,"data-svelte-h":!0}),O(A)!=="svelte-2i45b8"&&(A.textContent=nt),Y=g(X),E=v(X,"SELECT",{});var at=V(E);for(let tt=0;tt<10;tt+=1)U[tt].l(at);at.forEach(h),X.forEach(h),J=g(n),N=v(n,"DIV",{id:!0,class:!0});var st=V(N);vt(D.$$.fragment,st),st.forEach(h),this.h()},h(){R(w,"for","tempo"),R(C,"type","number"),R(C,"min","1"),R(C,"max","400"),R(A,"for","beatsInBar"),s[0].beatsPerBar===void 0&&gt(()=>s[10].call(E)),R(N,"id","canvas-container"),R(N,"class","d-flex justify-content-center")},m(n,f){k(n,t,f),k(n,o,f),k(n,i,f),c(i,l),c(l,u),k(n,M,f),k(n,r,f),c(r,x),c(r,K),c(r,_),c(r,j),c(r,w),c(r,Q),c(r,C),et(C,s[0].tempo),c(r,q),c(r,e),c(r,I),c(r,P),k(n,H,f),k(n,S,f),c(S,A),c(S,Y),c(S,E);for(let L=0;L<10;L+=1)U[L]&&U[L].m(E,null);it(E,s[0].beatsPerBar,!0),k(n,J,f),k(n,N,f),_t(D,N,null),F=!0,Z||(ot=[$(window,"keydown",s[1]),$(l,"click",s[4]),$(x,"click",s[5]),$(_,"click",s[6]),$(C,"input",s[7]),$(e,"click",s[8]),$(P,"click",s[9]),$(E,"change",s[10])],Z=!0)},p(n,[f]){(!F||f&1)&&d!==(d=n[0].isRunning?"Pause":"Play")&&yt(u,d),f&1&&ct(C.value)!==n[0].tempo&&et(C,n[0].tempo),f&1&&it(E,n[0].beatsPerBar)},i(n){F||(pt(D.$$.fragment,n),F=!0)},o(n){xt(D.$$.fragment,n),F=!1},d(n){n&&(h(t),h(o),h(i),h(M),h(r),h(H),h(S),h(J),h(N)),It(U,n),Ct(D),Z=!1,Pt(ot)}}}function Ot(s,t,a){let o=!1,i=0;const l=e=>{o=!0,i=e},d=()=>{o=!1};let u=new $t(80,l,d);const M=e=>{const y=" ";if([y].includes(e.key)&&(e.preventDefault(),e.key===y)){W();return}};let r,x="white",z="white";const K=e=>{e.setup=()=>{r=e,e.createCanvas(600,300),e.textSize(40)},e.draw=()=>{const y=document.getElementById("canvas-container");if(y){const b=(y==null?void 0:y.clientWidth)||600;e.width!==b&&e.resizeCanvas(b,Math.max(b/3,100))}e.clear(),e.stroke(x);const I=Math.min(e.width/u.beatsPerBar,e.height);for(let b=0;b<u.beatsPerBar;b++)o&&b===i?e.fill(x):e.noFill(),e.circle(b*I+I/2,e.height/2,I*.9);o?e.fill(z):e.fill(x);const P=(i+1).toString();e.text(P,i*I+I/2-e.textWidth(P)/2,e.height/2+e.textSize()/2)}},_=e=>{a(0,u.tempo=Number(u.tempo)+e,u)},W=()=>{u.startStop(),a(0,u)};kt(()=>{const e=getComputedStyle(document.body);x=e.getPropertyValue("--nc-tx-3"),z=e.getPropertyValue("--nc-tx-2")}),wt(()=>{r==null||r.remove(),u.stop()});const j=()=>_(-5),w=()=>_(-1);function G(){u.tempo=ct(this.value),a(0,u)}const Q=()=>_(1),C=()=>_(5);function q(){u.beatsPerBar=Et(this),a(0,u)}return[u,M,K,_,W,j,w,G,Q,C,q]}class Rt extends dt{constructor(t){super(),ft(this,t,Ot,Lt,rt,{})}}function Vt(s){let t,a;return t=new Rt({}),{c(){mt(t.$$.fragment)},l(o){vt(t.$$.fragment,o)},m(o,i){_t(t,o,i),a=!0},p:ht,i(o){a||(pt(t.$$.fragment,o),a=!0)},o(o){xt(t.$$.fragment,o),a=!1},d(o){Ct(t,o)}}}class jt extends dt{constructor(t){super(),ft(this,t,null,Vt,rt,{})}}export{jt as component};
