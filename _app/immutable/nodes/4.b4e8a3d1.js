var et=Object.defineProperty;var nt=(o,t,n)=>t in o?et(o,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[t]=n;var m=(o,t,n)=>(nt(o,typeof t!="symbol"?t+"":t,n),n);import{s as X,f as h,a as C,g as d,B as w,c as x,h as O,d as _,j as ot,G as st,i as b,D as u,H as Q,I as W,C as v,A as V,J as at,E as it,l as lt,m as rt,K as ut}from"../chunks/scheduler.def75234.js";import{S as Y,i as Z,b as ct,d as ht,m as dt,a as _t,t as mt,e as ft}from"../chunks/index.a7d56d8a.js";import{e as pt}from"../chunks/each.3b3cb8a2.js";class vt{constructor(t=120){m(this,"audioContext");m(this,"notesInQueue",[]);m(this,"currentBeatInBar");m(this,"beatsPerBar");m(this,"tempo");m(this,"lookahead");m(this,"scheduleAheadTime");m(this,"nextNoteTime");m(this,"isRunning");m(this,"intervalID");this.audioContext=null,this.notesInQueue=[],this.currentBeatInBar=0,this.beatsPerBar=4,this.tempo=t,this.lookahead=25,this.scheduleAheadTime=.1,this.nextNoteTime=0,this.isRunning=!1,this.intervalID=null}nextNote(){var t=60/this.tempo;this.nextNoteTime+=t,this.currentBeatInBar++,this.currentBeatInBar==this.beatsPerBar&&(this.currentBeatInBar=0)}scheduleNote(t,n){if(!this.audioContext)return;this.notesInQueue.push({note:t,time:n});const e=this.audioContext.createOscillator(),a=this.audioContext.createGain();e.frequency.value=t%this.beatsPerBar==0?1e3:800,a.gain.value=1,a.gain.exponentialRampToValueAtTime(1,n+.001),a.gain.exponentialRampToValueAtTime(.001,n+.02),e.connect(a),a.connect(this.audioContext.destination),e.start(n),e.stop(n+.03)}scheduler(){if(this.audioContext)for(;this.nextNoteTime<this.audioContext.currentTime+this.scheduleAheadTime;)this.scheduleNote(this.currentBeatInBar,this.nextNoteTime),this.nextNote()}start(){this.isRunning||(this.audioContext||(this.audioContext=new(window.AudioContext||window.webkitAudioContext)),this.isRunning=!0,this.currentBeatInBar=0,this.nextNoteTime=this.audioContext.currentTime+.05,this.intervalID=setInterval(()=>this.scheduler(),this.lookahead))}stop(){this.isRunning=!1,this.intervalID&&clearInterval(this.intervalID)}startStop(){this.isRunning?this.stop():this.start()}}function Ct(o,t,n){const e=o.slice();return e[10]=t[n],e}function xt(o){let t,n,e;return{c(){t=h("option"),n=lt(o[10]),e=C(),this.h()},l(a){t=d(a,"OPTION",{});var r=O(t);n=rt(r,o[10]),e=x(r),r.forEach(_),this.h()},h(){t.__value=o[10],Q(t,t.__value)},m(a,r){b(a,t,r),u(t,n),u(t,e)},p:V,d(a){a&&_(t)}}}function Bt(o){let t,n="Metronome",e,a,r,R="Play / Pause",N,i,p,S="-5",E,B,P="-1",y,T,$="Tempo:",K,I,j,k,z="+1",q,g,G="+5",U,D,f,L,H,tt=pt([1,2,3,4,5,6,7,8,9,10]),A=[];for(let s=0;s<10;s+=1)A[s]=xt(Ct(o,tt,s));return{c(){t=h("h3"),t.textContent=n,e=C(),a=h("div"),r=h("button"),r.textContent=R,N=C(),i=h("div"),p=h("button"),p.textContent=S,E=C(),B=h("button"),B.textContent=P,y=C(),T=h("label"),T.textContent=$,K=C(),I=h("input"),j=C(),k=h("button"),k.textContent=z,q=C(),g=h("button"),g.textContent=G,U=C(),D=h("div"),f=h("select");for(let s=0;s<10;s+=1)A[s].c();this.h()},l(s){t=d(s,"H3",{"data-svelte-h":!0}),w(t)!=="svelte-1ufzmuu"&&(t.textContent=n),e=x(s),a=d(s,"DIV",{});var c=O(a);r=d(c,"BUTTON",{"data-svelte-h":!0}),w(r)!=="svelte-gz8i74"&&(r.textContent=R),c.forEach(_),N=x(s),i=d(s,"DIV",{});var l=O(i);p=d(l,"BUTTON",{"data-svelte-h":!0}),w(p)!=="svelte-w9oex2"&&(p.textContent=S),E=x(l),B=d(l,"BUTTON",{"data-svelte-h":!0}),w(B)!=="svelte-1skmd72"&&(B.textContent=P),y=x(l),T=d(l,"LABEL",{for:!0,"data-svelte-h":!0}),w(T)!=="svelte-1jbxdvi"&&(T.textContent=$),K=x(l),I=d(l,"INPUT",{}),j=x(l),k=d(l,"BUTTON",{"data-svelte-h":!0}),w(k)!=="svelte-tql01y"&&(k.textContent=z),q=x(l),g=d(l,"BUTTON",{"data-svelte-h":!0}),w(g)!=="svelte-owj3gu"&&(g.textContent=G),l.forEach(_),U=x(s),D=d(s,"DIV",{});var J=O(D);f=d(J,"SELECT",{});var F=O(f);for(let M=0;M<10;M+=1)A[M].l(F);F.forEach(_),J.forEach(_),this.h()},h(){ot(T,"for","tempo"),o[0].beatsPerBar===void 0&&st(()=>o[8].call(f))},m(s,c){b(s,t,c),b(s,e,c),b(s,a,c),u(a,r),b(s,N,c),b(s,i,c),u(i,p),u(i,E),u(i,B),u(i,y),u(i,T),u(i,K),u(i,I),Q(I,o[0].tempo),u(i,j),u(i,k),u(i,q),u(i,g),b(s,U,c),b(s,D,c),u(D,f);for(let l=0;l<10;l+=1)A[l]&&A[l].m(f,null);W(f,o[0].beatsPerBar,!0),L||(H=[v(window,"keydown",o[1]),v(r,"click",o[2]),v(p,"click",o[3]),v(B,"click",o[4]),v(I,"input",o[5]),v(k,"click",o[6]),v(g,"click",o[7]),v(f,"change",o[8]),v(f,"change",o[9])],L=!0)},p(s,[c]){c&1&&I.value!==s[0].tempo&&Q(I,s[0].tempo),c&1&&W(f,s[0].beatsPerBar)},i:V,o:V,d(s){s&&(_(t),_(e),_(a),_(N),_(i),_(U),_(D)),at(A,s),L=!1,it(H)}}}function Tt(o,t,n){let e=new vt;const a=P=>{const y=" ";if([y].includes(P.key)&&(P.preventDefault(),P.key===y)){e.startStop();return}},r=()=>e.startStop(),R=()=>n(0,e.tempo-=5,e),N=()=>n(0,e.tempo-=1,e);function i(){e.tempo=this.value,n(0,e)}const p=()=>n(0,e.tempo+=1,e),S=()=>n(0,e.tempo+=5,e);function E(){e.beatsPerBar=ut(this),n(0,e)}return[e,a,r,R,N,i,p,S,E,()=>console.log(e.beatsPerBar)]}class bt extends Y{constructor(t){super(),Z(this,t,Tt,Bt,X,{})}}function It(o){let t,n;return t=new bt({}),{c(){ct(t.$$.fragment)},l(e){ht(t.$$.fragment,e)},m(e,a){dt(t,e,a),n=!0},p:V,i(e){n||(_t(t.$$.fragment,e),n=!0)},o(e){mt(t.$$.fragment,e),n=!1},d(e){ft(t,e)}}}class Pt extends Y{constructor(t){super(),Z(this,t,null,It,X,{})}}export{Pt as component};
