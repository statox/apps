var bt=Object.defineProperty;var Tt=(o,t,s)=>t in o?bt(o,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[t]=s;var v=(o,t,s)=>(Tt(o,typeof t!="symbol"?t+"":t,s),s);import{s as lt,f,a as b,l as rt,g as m,B as O,c as T,h as L,m as ut,d as h,j as V,G as gt,i as P,D as c,H as et,I as it,C as N,n as It,J as ct,K as yt,E as Pt,o as kt,F as wt,A as ht,L as St}from"../chunks/scheduler.d1ddc063.js";import{S as dt,i as ft,b as mt,d as _t,m as vt,a as pt,t as xt,e as Ct}from"../chunks/index.08fa6e96.js";import{e as Et}from"../chunks/each.ddcc6c50.js";import{P as Nt}from"../chunks/P5.f9f50a47.js";class $t{constructor(t=120,s,a){v(this,"audioContext");v(this,"notesInQueue",[]);v(this,"currentBeatInBar");v(this,"beatsPerBar");v(this,"tempo");v(this,"lookahead");v(this,"scheduleAheadTime");v(this,"nextNoteTime");v(this,"isRunning");v(this,"intervalID");v(this,"onBeatStart");v(this,"onBeatEnd");this.audioContext=null,this.notesInQueue=[],this.currentBeatInBar=0,this.beatsPerBar=4,this.tempo=t,this.lookahead=25,this.scheduleAheadTime=.1,this.nextNoteTime=0,this.isRunning=!1,this.intervalID=null,this.onBeatStart=s,this.onBeatEnd=a}nextNote(){var t=60/this.tempo;this.nextNoteTime+=t,this.currentBeatInBar++,this.currentBeatInBar==this.beatsPerBar&&(this.currentBeatInBar=0)}scheduleNote(t,s){if(!this.audioContext)return;this.notesInQueue.push({note:t,time:s});const a=this.audioContext.createOscillator(),i=this.audioContext.createGain();a.frequency.value=t%this.beatsPerBar==0?1e3:400,i.gain.value=1,i.gain.exponentialRampToValueAtTime(1,s+.001),i.gain.exponentialRampToValueAtTime(.001,s+.02),a.connect(i),i.connect(this.audioContext.destination);const r=this.audioContext.createConstantSource();r.onended=()=>{this.onBeatStart(t),a.start(),a.stop(s+.03),a.onended=()=>{this.onBeatEnd()}},r.start(s),r.stop(this.audioContext.currentTime+1e-4)}scheduler(){if(this.audioContext)for(;this.nextNoteTime<this.audioContext.currentTime+this.scheduleAheadTime;)this.scheduleNote(this.currentBeatInBar,this.nextNoteTime),this.nextNote()}start(){this.isRunning||(this.audioContext||(this.audioContext=new(window.AudioContext||window.webkitAudioContext)),this.isRunning=!0,this.currentBeatInBar=0,this.nextNoteTime=this.audioContext.currentTime+.05,this.intervalID=setInterval(()=>this.scheduler(),this.lookahead))}stop(){this.isRunning=!1,this.intervalID&&clearInterval(this.intervalID)}startStop(){this.isRunning?this.stop():this.start()}}function Dt(o,t,s){const a=o.slice();return a[18]=t[s],a}function At(o){let t,s,a;return{c(){t=f("option"),s=rt(o[18]),a=b(),this.h()},l(i){t=m(i,"OPTION",{});var r=L(t);s=ut(r,o[18]),a=T(r),r.forEach(h),this.h()},h(){t.__value=o[18],et(t,t.__value)},m(i,r){P(i,t,r),c(t,s),c(t,a)},p:ht,d(i){i&&h(t)}}}function Rt(o){let t,s="Metronome",a,i,r,$=o[0].isRunning?"Pause":"Play",u,M,l,p,z="-5",K,_,W="-1",j,k,G="Tempo:",Q,x,q,e,g="+1",I,y,B="+5",H,S,D,nt="Beats in bar",Y,w,J,E,A,F,Z,at,Bt=Et([1,2,3,4,5,6,7,8,9,10]),U=[];for(let n=0;n<10;n+=1)U[n]=At(Dt(o,Bt,n));return A=new Nt({props:{sketch:o[2]}}),{c(){t=f("h3"),t.textContent=s,a=b(),i=f("div"),r=f("button"),u=rt($),M=b(),l=f("div"),p=f("button"),p.textContent=z,K=b(),_=f("button"),_.textContent=W,j=b(),k=f("label"),k.textContent=G,Q=b(),x=f("input"),q=b(),e=f("button"),e.textContent=g,I=b(),y=f("button"),y.textContent=B,H=b(),S=f("div"),D=f("label"),D.textContent=nt,Y=b(),w=f("select");for(let n=0;n<10;n+=1)U[n].c();J=b(),E=f("div"),mt(A.$$.fragment),this.h()},l(n){t=m(n,"H3",{"data-svelte-h":!0}),O(t)!=="svelte-1ufzmuu"&&(t.textContent=s),a=T(n),i=m(n,"DIV",{});var d=L(i);r=m(d,"BUTTON",{});var R=L(r);u=ut(R,$),R.forEach(h),d.forEach(h),M=T(n),l=m(n,"DIV",{});var C=L(l);p=m(C,"BUTTON",{"data-svelte-h":!0}),O(p)!=="svelte-u06bp1"&&(p.textContent=z),K=T(C),_=m(C,"BUTTON",{"data-svelte-h":!0}),O(_)!=="svelte-xp648t"&&(_.textContent=W),j=T(C),k=m(C,"LABEL",{for:!0,"data-svelte-h":!0}),O(k)!=="svelte-1jbxdvi"&&(k.textContent=G),Q=T(C),x=m(C,"INPUT",{type:!0,min:!0,max:!0}),q=T(C),e=m(C,"BUTTON",{"data-svelte-h":!0}),O(e)!=="svelte-uulzng"&&(e.textContent=g),I=T(C),y=m(C,"BUTTON",{"data-svelte-h":!0}),O(y)!=="svelte-sukv70"&&(y.textContent=B),C.forEach(h),H=T(n),S=m(n,"DIV",{});var X=L(S);D=m(X,"LABEL",{for:!0,"data-svelte-h":!0}),O(D)!=="svelte-2i45b8"&&(D.textContent=nt),Y=T(X),w=m(X,"SELECT",{});var ot=L(w);for(let tt=0;tt<10;tt+=1)U[tt].l(ot);ot.forEach(h),X.forEach(h),J=T(n),E=m(n,"DIV",{id:!0,class:!0});var st=L(E);_t(A.$$.fragment,st),st.forEach(h),this.h()},h(){V(k,"for","tempo"),V(x,"type","number"),V(x,"min","1"),V(x,"max","400"),V(D,"for","beatsInBar"),o[0].beatsPerBar===void 0&&gt(()=>o[10].call(w)),V(E,"id","canvas-container"),V(E,"class","d-flex justify-content-center")},m(n,d){P(n,t,d),P(n,a,d),P(n,i,d),c(i,r),c(r,u),P(n,M,d),P(n,l,d),c(l,p),c(l,K),c(l,_),c(l,j),c(l,k),c(l,Q),c(l,x),et(x,o[0].tempo),c(l,q),c(l,e),c(l,I),c(l,y),P(n,H,d),P(n,S,d),c(S,D),c(S,Y),c(S,w);for(let R=0;R<10;R+=1)U[R]&&U[R].m(w,null);it(w,o[0].beatsPerBar,!0),P(n,J,d),P(n,E,d),vt(A,E,null),F=!0,Z||(at=[N(window,"keydown",o[1]),N(r,"click",o[4]),N(p,"click",o[5]),N(_,"click",o[6]),N(x,"input",o[7]),N(e,"click",o[8]),N(y,"click",o[9]),N(w,"change",o[10])],Z=!0)},p(n,[d]){(!F||d&1)&&$!==($=n[0].isRunning?"Pause":"Play")&&It(u,$),d&1&&ct(x.value)!==n[0].tempo&&et(x,n[0].tempo),d&1&&it(w,n[0].beatsPerBar)},i(n){F||(pt(A.$$.fragment,n),F=!0)},o(n){xt(A.$$.fragment,n),F=!1},d(n){n&&(h(t),h(a),h(i),h(M),h(l),h(H),h(S),h(J),h(E)),yt(U,n),Ct(A),Z=!1,Pt(at)}}}function Ot(o,t,s){let a=!1,i=0;const r=e=>{a=!0,i=e},$=()=>{a=!1};let u=new $t(80,r,$);const M=e=>{const g=" ";if([g].includes(e.key)&&(e.preventDefault(),e.key===g)){W();return}};let l,p="white",z="white";const K=e=>{e.setup=()=>{l=e,e.createCanvas(600,300),e.textSize(40)},e.draw=()=>{const g=document.getElementById("canvas-container");if(g){const B=(g==null?void 0:g.clientWidth)||600;e.width!==B&&e.resizeCanvas(B,Math.max(B/3,100))}e.clear(),e.stroke(p);const I=Math.min(e.width/u.beatsPerBar,e.height);for(let B=0;B<u.beatsPerBar;B++)a&&B===i?e.fill(p):e.noFill(),e.circle(B*I+I/2,e.height/2,I*.9);a?e.fill(z):e.fill(p);const y=(i+1).toString();e.text(y,i*I+I/2-e.textWidth(y)/2,e.height/2+e.textSize()/2)}},_=e=>{s(0,u.tempo=Number(u.tempo)+e,u)},W=()=>{u.startStop(),s(0,u)};kt(()=>{const e=getComputedStyle(document.body);p=e.getPropertyValue("--nc-tx-3"),z=e.getPropertyValue("--nc-tx-2")}),wt(()=>{l==null||l.remove(),u.stop()});const j=()=>_(-5),k=()=>_(-1);function G(){u.tempo=ct(this.value),s(0,u)}const Q=()=>_(1),x=()=>_(5);function q(){u.beatsPerBar=St(this),s(0,u)}return[u,M,K,_,W,j,k,G,Q,x,q]}class Vt extends dt{constructor(t){super(),ft(this,t,Ot,Rt,lt,{})}}function Lt(o){let t,s;return t=new Vt({}),{c(){mt(t.$$.fragment)},l(a){_t(t.$$.fragment,a)},m(a,i){vt(t,a,i),s=!0},p:ht,i(a){s||(pt(t.$$.fragment,a),s=!0)},o(a){xt(t.$$.fragment,a),s=!1},d(a){Ct(t,a)}}}class jt extends dt{constructor(t){super(),ft(this,t,null,Lt,lt,{})}}export{jt as component};
