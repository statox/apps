var ne=Object.defineProperty;var ie=(a,e,i)=>e in a?ne(a,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):a[e]=i;var p=(a,e,i)=>(ie(a,typeof e!="symbol"?e+"":e,i),i);import{s as Kt,f as o,a as m,l as St,g as l,h as g,B as C,c as b,m as Nt,d as B,k as ot,j as u,G as K,i as ae,D as t,H as Ft,C as T,n as jt,I as Qt,E as oe,o as le,F as re,A as ue}from"../chunks/scheduler.bdcfd8e9.js";import{S as Gt,i as Jt,b as Xt,d as Yt,m as $t,a as te,t as ee,e as se}from"../chunks/index.0dadadd9.js";import{P as ce}from"../chunks/P5.3ddf1f0d.js";class he{constructor(e=120,i,r){p(this,"audioContext");p(this,"notesInQueue",[]);p(this,"currentBeatInBar");p(this,"beatsPerBar");p(this,"currentSubdivision");p(this,"subdivisionsInBeat");p(this,"tempo");p(this,"lookahead");p(this,"scheduleAheadTime");p(this,"nextNoteTime");p(this,"isRunning");p(this,"intervalID");p(this,"onBeatStart");p(this,"onBeatEnd");this.audioContext=null,this.notesInQueue=[],this.currentBeatInBar=0,this.currentSubdivision=0,this.subdivisionsInBeat=1,this.beatsPerBar=4,this.tempo=e,this.lookahead=25,this.scheduleAheadTime=.1,this.nextNoteTime=0,this.isRunning=!1,this.intervalID=null,this.onBeatStart=i,this.onBeatEnd=r}nextNote(){var e=60/this.subdivisionsInBeat/this.tempo;this.nextNoteTime+=e,this.currentSubdivision++,this.currentSubdivision>=this.subdivisionsInBeat&&(this.currentBeatInBar++,this.currentSubdivision=0),this.currentBeatInBar>=this.beatsPerBar&&(this.currentBeatInBar=0)}scheduleNote(e,i,r){if(!this.audioContext)return;this.notesInQueue.push({note:e,time:r});const h=this.audioContext.createOscillator(),f=this.audioContext.createGain(),P=1e3,A=400,s=200;i!==0?h.frequency.value=s:e%this.beatsPerBar===0?h.frequency.value=P:h.frequency.value=A,f.gain.value=1,f.gain.exponentialRampToValueAtTime(1,r+.001),f.gain.exponentialRampToValueAtTime(.001,r+.02),h.connect(f),f.connect(this.audioContext.destination);const O=this.audioContext.createConstantSource();O.onended=()=>{this.onBeatStart(e,i),h.start(),h.stop(r+.03),h.onended=()=>{this.onBeatEnd()}},O.start(r),O.stop(this.audioContext.currentTime+1e-4)}scheduler(){if(this.audioContext)for(;this.nextNoteTime<this.audioContext.currentTime+this.scheduleAheadTime;)this.scheduleNote(this.currentBeatInBar,this.currentSubdivision,this.nextNoteTime),this.nextNote()}start(){this.isRunning||(this.audioContext||(this.audioContext=new(window.AudioContext||window.webkitAudioContext)),this.isRunning=!0,this.currentBeatInBar=0,this.currentSubdivision=0,this.nextNoteTime=this.audioContext.currentTime+.05,this.intervalID=setInterval(()=>this.scheduler(),this.lookahead))}stop(){this.isRunning=!1,this.intervalID&&clearInterval(this.intervalID)}startStop(){this.isRunning?this.stop():this.start()}}function de(a){let e,i,r="Metronome",h,f,P,A=a[0].isRunning?"Pause":"Play",s,O,_,w,S,lt="-5",tt,U,rt="-1",it,q,k,ut,ct,R,Z,_t="+1",ht,n,y="+5",x,I,M,d,Q="<h4>Beats in bar</h4>",pt,N,G,Ht="-1",Bt,W,at=a[0].beatsPerBar+"",dt,gt,J,zt="+1",wt,xt,It,F,X,Et="<h4>Subdivisions in beat<h4></h4></h4>",Ct,V,H,Dt='<svg width="15" height="15" fill="blue" xmlns="http://www.w3.org/2000/svg" style="width: 15px; height: auto;"><path d="M 4.3 0 v 9.6 A 2.9 2.9 0 0 0 0 12.1 A 3 3 0 0 0 3 15 c 1.5 0 2.8 -1.3 2.8 -2.9 V 3 V 0 H 4.3 Z"></path></svg>',Tt,z,Lt='<svg width="15" height="15" fill="blue" xmlns="http://www.w3.org/2000/svg" style="width: 15px; height: auto;"><path d="M4.3 0v9.6A2.9 2.9 0 0 0 0 12.1 3 3 0 0 0 3 15c1.5 0 2.8-1.3 2.8-2.9V3h7.7v6.6a2.9 2.9 0 0 0-4.3 2.5 2.9 2.9 0 0 0 5.8 0V0H4.3Z"></path></svg>',kt,E,At='<svg width="24" height="21" fill="blue" xmlns="http://www.w3.org/2000/svg" style="width: 24px; height: auto; top: -3px;"><path clip-rule="evenodd" d="M4.3 15.6V6H24v12.1a3 3 0 0 1-3 2.9 2.9 2.9 0 0 1-2.8-2.9 2.9 2.9 0 0 1 4.3-2.5V9H15v9.1a2.9 2.9 0 0 1-3 2.9 3 3 0 0 1-3-2.9 2.9 2.9 0 0 1 3-2.8c.5 0 1 0 1.3.3V9H5.8v9.1C5.8 19.7 4.5 21 3 21a3 3 0 0 1-3-2.9 2.9 2.9 0 0 1 4.3-2.5Z"></path><path d="M12.6 2.2 13.9.5V0h-3.1v.4h2.5l-1.4 1.7v.4h.4c.9 0 1.3.4 1.3 1s-.4 1-1.2 1c-.7 0-1.3-.3-1.6-.6l-.2.4c.4.4 1 .6 1.8.6 1.1 0 1.7-.6 1.7-1.4 0-.8-.5-1.3-1.5-1.4Z"></path></svg>',yt,D,Ot='<svg width="27" height="13" fill="blue" xmlns="http://www.w3.org/2000/svg" style="width: 27px; height: auto;"><path clip-rule="evenodd" d="M3.5 0v7.9a2 2 0 0 0-1.1-.3C1 7.6 0 8.6 0 9.9c0 1.3 1 2.4 2.4 2.4 1.3 0 2.3-1 2.3-2.4V3.4H11V8a2 2 0 0 0-1.1-.3 2.3 2.3 0 1 0 0 4.7c1.3 0 2.4-1 2.4-2.4V3.4h6.1V8a2.4 2.4 0 0 0-1-.3c-1.4 0-2.5 1-2.5 2.3 0 1.3 1.1 2.4 2.4 2.4 1.3 0 2.4-1 2.4-2.4V3.4h6.2V8l-1.2-.3c-1.3 0-2.3 1-2.3 2.3a2.3 2.3 0 1 0 4.7 0V0H3.5Zm7.4 2.7H4.7V1.5H11v1.2Zm7.4 0h-6.1V1.5h6.1v1.2Zm1.3 0h6.2V1.5h-6.2v1.2Z"></path></svg>',Vt,Y,$,L,Pt,Ut;return $=new ce({props:{sketch:a[2]}}),{c(){e=o("div"),i=o("h3"),i.textContent=r,h=m(),f=o("div"),P=o("button"),s=St(A),O=m(),_=o("div"),w=o("div"),S=o("button"),S.textContent=lt,tt=m(),U=o("button"),U.textContent=rt,it=m(),q=o("div"),k=o("input"),ut=St(" BPM"),ct=m(),R=o("div"),Z=o("button"),Z.textContent=_t,ht=m(),n=o("button"),n.textContent=y,x=m(),I=o("div"),M=o("div"),d=o("label"),d.innerHTML=Q,pt=m(),N=o("div"),G=o("button"),G.textContent=Ht,Bt=m(),W=o("span"),dt=St(at),gt=m(),J=o("button"),J.textContent=zt,wt=m(),xt=o("br"),It=m(),F=o("div"),X=o("label"),X.innerHTML=Et,Ct=m(),V=o("div"),H=o("button"),H.innerHTML=Dt,Tt=m(),z=o("button"),z.innerHTML=Lt,kt=m(),E=o("button"),E.innerHTML=At,yt=m(),D=o("button"),D.innerHTML=Ot,Vt=m(),Y=o("div"),Xt($.$$.fragment),this.h()},l(v){e=l(v,"DIV",{class:!0});var c=g(e);i=l(c,"H3",{"data-svelte-h":!0}),C(i)!=="svelte-1ufzmuu"&&(i.textContent=r),h=b(c),f=l(c,"DIV",{class:!0});var Rt=g(f);P=l(Rt,"BUTTON",{style:!0});var qt=g(P);s=Nt(qt,A),qt.forEach(B),Rt.forEach(B),O=b(c),_=l(c,"DIV",{class:!0});var et=g(_);w=l(et,"DIV",{class:!0});var vt=g(w);S=l(vt,"BUTTON",{"data-svelte-h":!0}),C(S)!=="svelte-boesh5"&&(S.textContent=lt),tt=b(vt),U=l(vt,"BUTTON",{"data-svelte-h":!0}),C(U)!=="svelte-1xtzs1"&&(U.textContent=rt),vt.forEach(B),it=b(et),q=l(et,"DIV",{class:!0});var Mt=g(q);k=l(Mt,"INPUT",{style:!0,type:!0,min:!0,max:!0}),ut=Nt(Mt," BPM"),Mt.forEach(B),ct=b(et),R=l(et,"DIV",{class:!0});var mt=g(R);Z=l(mt,"BUTTON",{"data-svelte-h":!0}),C(Z)!=="svelte-yi7qi1"&&(Z.textContent=_t),ht=b(mt),n=l(mt,"BUTTON",{"data-svelte-h":!0}),C(n)!=="svelte-5bd8rl"&&(n.textContent=y),mt.forEach(B),et.forEach(B),x=b(c),I=l(c,"DIV",{class:!0});var st=g(I);M=l(st,"DIV",{class:!0});var bt=g(M);d=l(bt,"LABEL",{for:!0,"data-svelte-h":!0}),C(d)!=="svelte-me1f1h"&&(d.innerHTML=Q),pt=b(bt),N=l(bt,"DIV",{class:!0});var nt=g(N);G=l(nt,"BUTTON",{"data-svelte-h":!0}),C(G)!=="svelte-bxtof5"&&(G.textContent=Ht),Bt=b(nt),W=l(nt,"SPAN",{style:!0});var Zt=g(W);dt=Nt(Zt,at),Zt.forEach(B),gt=b(nt),J=l(nt,"BUTTON",{"data-svelte-h":!0}),C(J)!=="svelte-1uol52n"&&(J.textContent=zt),nt.forEach(B),bt.forEach(B),wt=b(st),xt=l(st,"BR",{}),It=b(st),F=l(st,"DIV",{class:!0});var ft=g(F);X=l(ft,"LABEL",{for:!0,"data-svelte-h":!0}),C(X)!=="svelte-ffm4y8"&&(X.innerHTML=Et),Ct=b(ft),V=l(ft,"DIV",{class:!0});var j=g(V);H=l(j,"BUTTON",{class:!0,"data-svelte-h":!0}),C(H)!=="svelte-1u4as9s"&&(H.innerHTML=Dt),Tt=b(j),z=l(j,"BUTTON",{class:!0,"data-svelte-h":!0}),C(z)!=="svelte-35s1cu"&&(z.innerHTML=Lt),kt=b(j),E=l(j,"BUTTON",{class:!0,"data-svelte-h":!0}),C(E)!=="svelte-wyd7so"&&(E.innerHTML=At),yt=b(j),D=l(j,"BUTTON",{class:!0,"data-svelte-h":!0}),C(D)!=="svelte-5dz80a"&&(D.innerHTML=Ot),j.forEach(B),ft.forEach(B),st.forEach(B),Vt=b(c),Y=l(c,"DIV",{id:!0,class:!0});var Wt=g(Y);Yt($.$$.fragment,Wt),Wt.forEach(B),c.forEach(B),this.h()},h(){ot(P,"min-width","300px"),u(f,"class","controls-container svelte-wmmpzb"),u(w,"class","tempo-less svelte-wmmpzb"),ot(k,"font-size","x-large"),u(k,"type","number"),u(k,"min","1"),u(k,"max","400"),u(q,"class","tempo-value svelte-wmmpzb"),u(R,"class","tempo-more svelte-wmmpzb"),u(_,"class","tempo-container svelte-wmmpzb"),u(d,"for","beatsInBar"),ot(W,"font-size","large"),ot(W,"margin-left","1em"),ot(W,"margin-right","1em"),u(N,"class","subdivisions-container svelte-wmmpzb"),u(M,"class","controls-sub-container svelte-wmmpzb"),u(X,"for","subdivisionsInBeat"),u(H,"class","svelte-wmmpzb"),K(H,"selected",a[0].subdivisionsInBeat===1),u(z,"class","svelte-wmmpzb"),K(z,"selected",a[0].subdivisionsInBeat===2),u(E,"class","svelte-wmmpzb"),K(E,"selected",a[0].subdivisionsInBeat===3),u(D,"class","svelte-wmmpzb"),K(D,"selected",a[0].subdivisionsInBeat===4),u(V,"class","subdivisions-container svelte-wmmpzb"),u(F,"class","controls-sub-container svelte-wmmpzb"),u(I,"class","controls-container svelte-wmmpzb"),u(Y,"id","canvas-container"),u(Y,"class","d-flex justify-content-center"),u(e,"class","main svelte-wmmpzb")},m(v,c){ae(v,e,c),t(e,i),t(e,h),t(e,f),t(f,P),t(P,s),t(e,O),t(e,_),t(_,w),t(w,S),t(w,tt),t(w,U),t(_,it),t(_,q),t(q,k),Ft(k,a[0].tempo),t(q,ut),t(_,ct),t(_,R),t(R,Z),t(R,ht),t(R,n),t(e,x),t(e,I),t(I,M),t(M,d),t(M,pt),t(M,N),t(N,G),t(N,Bt),t(N,W),t(W,dt),t(N,gt),t(N,J),t(I,wt),t(I,xt),t(I,It),t(I,F),t(F,X),t(F,Ct),t(F,V),t(V,H),t(V,Tt),t(V,z),t(V,kt),t(V,E),t(V,yt),t(V,D),t(e,Vt),t(e,Y),$t($,Y,null),L=!0,Pt||(Ut=[T(window,"keydown",a[1]),T(P,"click",a[3]),T(S,"click",a[4]),T(U,"click",a[5]),T(k,"input",a[6]),T(Z,"click",a[7]),T(n,"click",a[8]),T(G,"click",a[9]),T(J,"click",a[10]),T(H,"click",a[11]),T(z,"click",a[12]),T(E,"click",a[13]),T(D,"click",a[14])],Pt=!0)},p(v,[c]){(!L||c&1)&&A!==(A=v[0].isRunning?"Pause":"Play")&&jt(s,A),c&1&&Qt(k.value)!==v[0].tempo&&Ft(k,v[0].tempo),(!L||c&1)&&at!==(at=v[0].beatsPerBar+"")&&jt(dt,at),(!L||c&1)&&K(H,"selected",v[0].subdivisionsInBeat===1),(!L||c&1)&&K(z,"selected",v[0].subdivisionsInBeat===2),(!L||c&1)&&K(E,"selected",v[0].subdivisionsInBeat===3),(!L||c&1)&&K(D,"selected",v[0].subdivisionsInBeat===4)},i(v){L||(te($.$$.fragment,v),L=!0)},o(v){ee($.$$.fragment,v),L=!1},d(v){v&&B(e),se($),Pt=!1,oe(Ut)}}}function ve(a,e,i){let r=!1,h=0,f=0;const P=(n,y)=>{r=!0,h=n,f=y},A=()=>{r=!1};let s=new he(80,P,A);const O=n=>{const y=" ";if([y].includes(n.key)&&(n.preventDefault(),n.key===y)){tt();return}};let _,w="white",S="white";const lt=n=>{n.setup=()=>{_=n,n.createCanvas(600,300),n.textSize(40)},n.draw=()=>{const y=document.getElementById("canvas-container");if(y){const d=(y==null?void 0:y.clientWidth)||600;n.width!==d&&n.resizeCanvas(d,Math.max(d/3,100))}n.clear(),n.stroke(w);const x=Math.min(n.width/s.beatsPerBar,n.height),I=n.height/s.subdivisionsInBeat;for(let d=0;d<s.beatsPerBar;d++){d===h?n.strokeWeight(3):n.strokeWeight(1),n.noFill(),n.circle(d*x+x/2,n.height/2,x*.9),n.strokeWeight(1);for(let Q=0;Q<s.subdivisionsInBeat;Q++)r&&d===h&&Q===f?n.fill(w):n.noFill(),n.circle(d*x+x/2,Q*I+I/2,x/s.subdivisionsInBeat*.9)}r?n.fill(S):n.fill(w);const M=(h+1).toString();n.text(M,h*x+x/2-n.textWidth(M)/2,n.height/2+n.textSize()/2)}},tt=()=>{s.startStop(),i(0,s)};le(()=>{const n=getComputedStyle(document.body);w=n.getPropertyValue("--nc-tx-3"),S=n.getPropertyValue("--nc-tx-2")}),re(()=>{_==null||_.remove(),s.stop()});const U=()=>i(0,s.tempo=Number(s.tempo)-5,s),rt=()=>i(0,s.tempo=Number(s.tempo)-1,s);function it(){s.tempo=Qt(this.value),i(0,s)}return[s,O,lt,tt,U,rt,it,()=>i(0,s.tempo=Number(s.tempo)+1,s),()=>i(0,s.tempo=Number(s.tempo)+5,s),()=>i(0,s.beatsPerBar=Math.max(s.beatsPerBar-1,1),s),()=>i(0,s.beatsPerBar=Math.min(s.beatsPerBar+1,10),s),()=>i(0,s.subdivisionsInBeat=1,s),()=>i(0,s.subdivisionsInBeat=2,s),()=>i(0,s.subdivisionsInBeat=3,s),()=>i(0,s.subdivisionsInBeat=4,s)]}class me extends Gt{constructor(e){super(),Jt(this,e,ve,de,Kt,{})}}function be(a){let e,i;return e=new me({}),{c(){Xt(e.$$.fragment)},l(r){Yt(e.$$.fragment,r)},m(r,h){$t(e,r,h),i=!0},p:ue,i(r){i||(te(e.$$.fragment,r),i=!0)},o(r){ee(e.$$.fragment,r),i=!1},d(r){se(e,r)}}}class ge extends Gt{constructor(e){super(),Jt(this,e,null,be,Kt,{})}}export{ge as component};
